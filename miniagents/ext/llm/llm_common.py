"""
TODO Oleksandr: docstring
"""

from typing import Any, Optional

from miniagents.messages import Message
from miniagents.miniagents import InteractionContext


class LangModelMessage(Message):
    """
    A message generated by a language model.
    """

    role: str
    model: str


def message_to_llm_dict(message: Message) -> dict[str, Any]:
    """
    TODO Oleksandr: docstring
    """
    # TODO Oleksandr: introduce a lambda function to derive roles from messages ?
    try:
        role = message.role
    except AttributeError:
        role = "user"

    return {
        "role": role,
        "content": str(message),
    }


def build_preliminary_reply_metadata(
    ctx: InteractionContext,
    global_reply_metadata: Optional[dict[str, Any]] = None,
    reply_metadata: Optional[dict[str, Any]] = None,
) -> dict[str, Any]:
    """
    TODO Oleksandr: docstring
    """
    return {
        "agent_alias": ctx.this_agent.alias,
        **(global_reply_metadata or {}),
        **(reply_metadata or {}),
    }
